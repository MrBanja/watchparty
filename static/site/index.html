<!DOCTYPE html>
<html>
<head>
    <title>T</title>
    <link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet"/>

    <script src="https://vjs.zencdn.net/7.11.4/video.min.js"></script>
    <script src="https://unpkg.com/@videojs/http-streaming@2.16.2/dist/videojs-http-streaming.js"></script>
</head>
<body>
<video id="my-video" class="video-js" controls preload="auto" width="640"
       height="264">
    <source src="http://localhost/static/content/output.m3u8"
            type="application/x-mpegURL">
</video>

<button id="play">Play</button>
<button id="pause">Pause</button>

<script>
    let player = videojs('my-video');
    let ws = new WebSocket("ws://localhost/ws/party");

    // Setting up button controls
    document.getElementById('play').addEventListener('click', function () {
        ws.send("play;" + player.currentTime());
    });

    document.getElementById('pause').addEventListener('click', function () {
        ws.send("pause;" + player.currentTime());
    });

    // player.on('play', function() {
    //     ws.send("play;" + player.currentTime());
    // });
    //
    // player.on('pause', function() {
    //     ws.send("pause;" + player.currentTime());
    // });

    //Triggered when the connection is opened
    ws.onopen = function (evt) {
        console.log("Connection open...");
    };
    //Triggered when a message is received
    ws.onmessage = function (evt) {
        console.log("Received Message: " + evt.data);
        let message = evt.data.split(';');
        switch (message[0]) {
            case 'pause':
                player.pause();
                player.currentTime(Number(message[1]));
                break;
            case 'play':
                player.play();
                player.currentTime(Number(message[1]));
                break;
            default:
                console.log('Unknown command: ' + evt.data);
        }
    };
    //Triggered when the connection is closed
    ws.onclose = function (evt) {
        console.log("Connection closed.");
    };

</script>
</body>
</html>
