<!DOCTYPE html>
<html lang="en">
<head>
    <title>WatchParty</title>
    <link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet"/>

    <script src="https://vjs.zencdn.net/7.11.4/video.min.js"></script>
    <script src="https://unpkg.com/@videojs/http-streaming@2.16.2/dist/videojs-http-streaming.js"></script>
</head>
<body>
<video id="my-video" class="video-js" controls preload="auto" width="1280" height="720">
    <source src="http://localhost:8000/static/content/output.m3u8" type="application/x-mpegURL">
    <track src="http://localhost:8000/static/content/sub_en.vtt" kind="subtitles" srclang="en" label="English" default>
</video>

<button id="play">Play</button>
<button id="pause">Pause</button>
<button id="click">CLICK ME</button>

<script>
    let player = videojs('my-video');
    let ws = new WebSocket("ws://localhost:8000/ws/party");

    // Setting up button controls
    document.getElementById('play').addEventListener('click', function () {
        ws.send("play;" + player.currentTime());
    });

    document.getElementById('pause').addEventListener('click', function () {
        ws.send("pause;" + player.currentTime());
    });

    //Triggered when the connection is opened
    ws.onopen = function (evt) {
        console.log("Connection open...");
    };
    //Triggered when a message is received
    ws.onmessage = function (evt) {
        console.log("Received Message: " + evt.data);
        let message = evt.data.split(';');
        switch (message[0]) {
            case 'pause':
                player.pause();
                player.currentTime(Number(message[1]));
                break;
            case 'play':
                player.play();
                player.currentTime(Number(message[1]));
                break;
            default:
                console.log('Unknown command: ' + evt.data);
        }
    };
    //Triggered when the connection is closed
    ws.onclose = function (evt) {
        console.log("Connection closed.");
    };

</script>
</body>
</html>
